<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>3D Car Racer</title>
    <style>
        body { margin: 0; overflow: hidden; background: #020617; font-family: Arial; }
        #menu {
            position: fixed; inset: 0; display: flex; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.8); color: white; z-index: 10;
        }
        .panel {
            background: #0f172a; padding: 20px; border-radius: 12px; width: 300px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        input, select, button {
            width: 100%; padding: 8px; margin-top: 8px; border-radius: 6px; border: none;
        }
        button { background: #2563eb; color: white; cursor: pointer; }
        #hud {
            position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.5);
            padding: 10px; border-radius: 8px; color: white; display: none;
        }
    </style>
</head>
<body>

<!-- MENU -->
<div id="menu">
    <div class="panel">
        <h2>3D Car Racer</h2>

        <label>Player Name</label>
        <input id="playerName" placeholder="Your name">

        <label>Car</label>
        <select id="carSelect">
            <option value="sport">Sport Car</option>
            <option value="muscle">Muscle Car</option>
            <option value="kart">Go-Kart</option>
        </select>

        <label>Driver</label>
        <select id="driverSelect">
            <option value="balanced">Balanced</option>
            <option value="aggressive">Aggressive</option>
            <option value="smooth">Smooth</option>
        </select>

        <button id="startBtn">Start Game</button>
    </div>
</div>

<!-- HUD -->
<div id="hud">
    <div id="hudName"></div>
    <div id="hudCar"></div>
    <div id="hudSpeed"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>

<script>
// ---------------- MENU ----------------
const menu = document.getElementById("menu");
const hud = document.getElementById("hud");

document.getElementById("startBtn").onclick = () => {
    startGame();
};

// ---------------- GAME CONFIG ----------------
let config = {
    name: "",
    car: "",
    driver: ""
};

// ---------------- THREE.JS SETUP ----------------
let scene, camera, renderer, car;
let speed = 0, steering = 0;
const keys = {};

init3D();
animate();

function init3D() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x020617);

    camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 6, 12);

    renderer = new THREE.WebGLRenderer({ antialias:true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const hemi = new THREE.HemisphereLight(0xffffff, 0x111827, 0.8);
    scene.add(hemi);

    const dir = new THREE.DirectionalLight(0xffffff, 1);
    dir.position.set(10,20,-10);
    scene.add(dir);

    const ground = new THREE.Mesh(
        new THREE.PlaneGeometry(500,500),
        new THREE.MeshStandardMaterial({ color:0x0f172a })
    );
    ground.rotation.x = -Math.PI/2;
    scene.add(ground);

    window.addEventListener("keydown", e => keys[e.code] = true);
    window.addEventListener("keyup", e => keys[e.code] = false);
    window.addEventListener("resize", onResize);
}

function createCar(type, driver) {
    if (car) scene.remove(car);
    car = new THREE.Group();

    let color = 0xff3333;
    let maxSpeed = 40;
    let accel = 20;
    let grip = 1;

    if (type === "sport") { color = 0x22c55e; maxSpeed = 55; accel = 22; grip = 0.9; }
    if (type === "muscle") { color = 0xf97316; maxSpeed = 45; accel = 26; grip = 0.8; }
    if (type === "kart") { color = 0x3b82f6; maxSpeed = 30; accel = 16; grip = 1.2; }

    if (driver === "aggressive") grip *= 0.8;
    if (driver === "smooth") grip *= 1.1;

    car.userData = { maxSpeed, accel, grip };

    const body = new THREE.Mesh(
        new THREE.BoxGeometry(2,0.6,4),
        new THREE.MeshStandardMaterial({ color })
    );
    body.position.y = 0.6;
    car.add(body);

    const wheelGeo = new THREE.CylinderGeometry(0.5,0.5,0.4,16);
    const wheelMat = new THREE.MeshStandardMaterial({ color:0x111111 });

    function wheel(x,z){
        const w = new THREE.Mesh(wheelGeo, wheelMat);
        w.rotation.z = Math.PI/2;
        w.position.set(x,0.3,z);
        return w;
    }

    car.add(wheel(1,1.5));
    car.add(wheel(-1,1.5));
    car.add(wheel(1,-1.5));
    car.add(wheel(-1,-1.5));

    scene.add(car);
}

function startGame() {
    config.name = document.getElementById("playerName").value || "Player";
    config.car = document.getElementById("carSelect").value;
    config.driver = document.getElementById("driverSelect").value;

    createCar(config.car, config.driver);

    document.getElementById("hudName").textContent = "Player: " + config.name;
    document.getElementById("hudCar").textContent = "Car: " + config.car;

    hud.style.display = "block";
    menu.style.display = "none";
}

function updateCar() {
    if (!car) return;

    const accel = car.userData.accel;
    const maxSpeed = car.userData.maxSpeed;
    const grip = car.userData.grip;

    if (keys["KeyW"]) speed += accel * 0.02;
    if (keys["KeyS"]) speed -= accel * 0.02;

    speed = Math.max(Math.min(speed, maxSpeed), -maxSpeed);

    if (!keys["KeyW"] && !keys["KeyS"]) {
        if (speed > 0) speed -= 8 * 0.02;
        if (speed < 0) speed += 8 * 0.02;
        if (Math.abs(speed) < 0.1) speed = 0;
    }

    let steerInput = 0;
    if (keys["KeyA"]) steerInput += 1;
    if (keys["KeyD"]) steerInput -= 1;

    car.rotation.y += steerInput * (speed/maxSpeed) * grip * 0.05;

    const forward = new THREE.Vector3(0,0,-1).applyQuaternion(car.quaternion);
    car.position.addScaledVector(forward, speed * 0.02);

    const camOffset = new THREE.Vector3(0,6,12).applyQuaternion(car.quaternion);
    camera.position.lerp(car.position.clone().add(camOffset), 0.1);
    camera.lookAt(car.position);

    document.getElementById("hudSpeed").textContent = "Speed: " + Math.round(speed);
}

function animate() {
    requestAnimationFrame(animate);
    updateCar();
    renderer.render(scene, camera);
}

function onResize() {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}
</script>

</body>
</html>

